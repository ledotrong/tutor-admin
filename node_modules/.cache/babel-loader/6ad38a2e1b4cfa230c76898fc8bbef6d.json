{"ast":null,"code":"import _regeneratorRuntime from\"/Users/trongledo/Documents/GitHub/tutor-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _classCallCheck from\"/Users/trongledo/Documents/GitHub/tutor-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/trongledo/Documents/GitHub/tutor-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/trongledo/Documents/GitHub/tutor-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/trongledo/Documents/GitHub/tutor-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/trongledo/Documents/GitHub/tutor-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component,Suspense}from'react';import{Redirect,Route,Switch}from'react-router-dom';import*as router from'react-router-dom';import{Container}from'reactstrap';import{AppFooter,AppHeader,AppBreadcrumb2 as AppBreadcrumb}from'@coreui/react';// routes config\nimport routes from'../../routes';var DefaultFooter=React.lazy(function(){return import('./DefaultFooter');});var DefaultHeader=React.lazy(function(){return import('./DefaultHeader');});var DefaultLayout=/*#__PURE__*/function(_Component){_inherits(DefaultLayout,_Component);function DefaultLayout(props){var _this;_classCallCheck(this,DefaultLayout);_this=_possibleConstructorReturn(this,_getPrototypeOf(DefaultLayout).call(this,props));_this.componentWillMount=function _callee(){var token;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// const token = localStorage.removeItem(\"token\");\ntoken=JSON.parse(localStorage.getItem('token'));if(token){_this.setState({token:token});}else{_this.props.history.push('/login');}case 2:case\"end\":return _context.stop();}}});};_this.componentDidMount=function _callee2(){var role;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!_this.state.token){_context2.next=7;break;}_context2.next=3;return _regeneratorRuntime.awrap(_this.getUsers());case 3:role=_context2.sent;localStorage.setItem('role',role);_context2.next=8;break;case 7:_this.props.history.push('/login');case 8:case\"end\":return _context2.stop();}}});};_this.getUsers=function _callee3(){var requestOptions,response,userData;return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:requestOptions={method:'GET',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(_this.state.token)}};_context3.prev=1;_context3.next=4;return _regeneratorRuntime.awrap(fetch('https://cors-anywhere.herokuapp.com/https://admin-api-tutor.herokuapp.com/me',requestOptions));case 4:response=_context3.sent;_context3.next=7;return _regeneratorRuntime.awrap(_this.handleResponse(response));case 7:userData=_context3.sent;return _context3.abrupt(\"return\",userData.role);case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](1);return _context3.abrupt(\"return\",_context3.t0);case 14:case\"end\":return _context3.stop();}}},null,null,[[1,11]]);};_this.loading=function(){return React.createElement(\"div\",{className:\"animated fadeIn pt-1 text-center\"},\"Loading...\");};_this.state={loading:true,token:null};return _this;}_createClass(DefaultLayout,[{key:\"handleResponse\",value:function handleResponse(response){var _this2=this;return response.text().then(function(text){var data=text&&JSON.parse(text);if(!response.ok){if(response.status===401){_this2.signOut();}return data;}return data;});}},{key:\"signOut\",value:function signOut(e){localStorage.clear();this.props.history.push('/login');}},{key:\"render\",value:function render(){var _this3=this;return React.createElement(\"div\",{className:\"app google-font\"},React.createElement(AppHeader,{fixed:true},React.createElement(Suspense,{fallback:this.loading()},React.createElement(DefaultHeader,{onLogout:function onLogout(e){return _this3.signOut(e);}}))),React.createElement(\"div\",{className:\"app-body\"},React.createElement(\"main\",{className:\"main\"},React.createElement(AppBreadcrumb,{appRoutes:routes,router:router}),React.createElement(Container,{fluid:true},React.createElement(Suspense,{fallback:this.loading()},React.createElement(Switch,null,routes.map(function(route,idx){return route.component?React.createElement(Route,{key:idx,path:route.path,exact:route.exact,name:route.name,render:function render(props){return React.createElement(route.component,props);}}):null;})))))),React.createElement(AppFooter,null,React.createElement(Suspense,{fallback:this.loading()},React.createElement(DefaultFooter,null))));}}]);return DefaultLayout;}(Component);export default DefaultLayout;","map":{"version":3,"sources":["/Users/trongledo/Documents/GitHub/tutor-admin/src/containers/DefaultLayout/DefaultLayout.js"],"names":["React","Component","Suspense","Redirect","Route","Switch","router","Container","AppFooter","AppHeader","AppBreadcrumb2","AppBreadcrumb","routes","DefaultFooter","lazy","DefaultHeader","DefaultLayout","props","componentWillMount","token","JSON","parse","localStorage","getItem","setState","history","push","componentDidMount","state","getUsers","role","setItem","requestOptions","method","headers","Authorization","fetch","response","handleResponse","userData","loading","text","then","data","ok","status","signOut","e","clear","map","route","idx","component","path","exact","name"],"mappings":"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","sourcesContent":["import React, { Component, Suspense } from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\nimport * as router from 'react-router-dom';\nimport { Container } from 'reactstrap';\n\nimport {\n  AppFooter,\n  AppHeader,\n  AppBreadcrumb2 as AppBreadcrumb\n} from '@coreui/react';\n// routes config\nimport routes from '../../routes';\n\nconst DefaultFooter = React.lazy(() => import('./DefaultFooter'));\nconst DefaultHeader = React.lazy(() => import('./DefaultHeader'));\n\nclass DefaultLayout extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n      token: null\n    };\n  }\n\n  componentWillMount = async () => {\n    // const token = localStorage.removeItem(\"token\");\n    const token = JSON.parse(localStorage.getItem('token'));\n\n    if (token) {\n      this.setState({ token });\n    } else {\n      this.props.history.push('/login');\n    }\n  };\n\n  componentDidMount = async () => {\n    if (this.state.token) {\n      const role = await this.getUsers();\n      localStorage.setItem('role', role);\n    } else {\n      this.props.history.push('/login');\n    }\n  };\n\n  getUsers = async () => {\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${this.state.token}`\n      }\n    };\n    try {\n      const response = await fetch(\n        'https://cors-anywhere.herokuapp.com/https://admin-api-tutor.herokuapp.com/me',\n        requestOptions\n      );\n\n      let userData = await this.handleResponse(response);\n\n      return userData.role;\n    } catch (err) {\n      return err;\n    }\n  };\n\n  handleResponse(response) {\n    return response.text().then(text => {\n      const data = text && JSON.parse(text);\n      if (!response.ok) {\n        if (response.status === 401) {\n          this.signOut();\n        }\n        return data;\n      }\n      return data;\n    });\n  }\n\n  loading = () => (\n    <div className=\"animated fadeIn pt-1 text-center\">Loading...</div>\n  );\n\n  signOut(e) {\n    localStorage.clear();\n    this.props.history.push('/login');\n  }\n\n  render() {\n    return (\n      <div className=\"app google-font\">\n        <AppHeader fixed>\n          <Suspense fallback={this.loading()}>\n            <DefaultHeader onLogout={e => this.signOut(e)} />\n          </Suspense>\n        </AppHeader>\n        <div className=\"app-body\">\n          <main className=\"main\">\n            <AppBreadcrumb appRoutes={routes} router={router} />\n            <Container fluid>\n              <Suspense fallback={this.loading()}>\n                <Switch>\n                  {routes.map((route, idx) => {\n                    return route.component ? (\n                      <Route\n                        key={idx}\n                        path={route.path}\n                        exact={route.exact}\n                        name={route.name}\n                        render={props => <route.component {...props} />}\n                      />\n                    ) : null;\n                  })}\n                </Switch>\n              </Suspense>\n            </Container>\n          </main>\n        </div>\n        <AppFooter>\n          <Suspense fallback={this.loading()}>\n            <DefaultFooter />\n          </Suspense>\n        </AppFooter>\n      </div>\n    );\n  }\n}\n\nexport default DefaultLayout;\n"]},"metadata":{},"sourceType":"module"}